


Asignación
Modelo Relacional Proyecto 1

Fecha
02/09/2024

Materia
Bases de Datos Avanzadas

Profesor
Alma Leticia Chavez Quintero









Procedures para funciones genéricas de la base de datos, como generar contraseña de N longitud.

DELIMITER $$
CREATE PROCEDURE passw(IN idtransaccion INT)
BEGIN 
	DECLARE caracteres VARCHAR(100) DEFAULT ‘ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789’
	DECLARE passsword VARCHAR(255) DEFAULT ‘’;
	DECLARE i INT DEFAULT 0;
WHILE i < 8 DO
SET password := CONCAT(password, SUBSTRING(caracteres, FLOOR(1 + RAND() * LENGTH(caracteres)), 1));
SET i := i + 1;
END WHILE;
UPDATE TransaccionFolioCliente SET password_transaccion = passsword WHERE id_transaccion = idtransaccion; 

END $$
DELIMITER ; 













DELIMITER $$
CREATE PROCEDURE folio(IN idtransaccion INT)
BEGIN 
	DECLARE caracteresFolio VARCHAR(100) DEFAULT ‘ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789’
	DECLARE folio VARCHAR(255) DEFAULT ‘’;
DECLARE i INT DEFAULT 0;
WHILE i < 20 DO 
	SET folio := CONCAT(folio, SUBSTRING(caracteresFolio, FLOOR(1 + RAND() * LENGTH(caracteresFolio)), 1));
	SET i := i + 1;
END WHILE;
UPDATE TransaccionFolioCliente SET folio_transaccion = folio WHERE id_transaccion = idtransaccion;


END$$
DELIMITER;











DELIMITER $$
CREATE TRIGGER tipo_transaccion
 AFTER INSERT ON transaccion
 FOR EACH ROW
 BEGIN
	DECLARE id int;
    
	SET id = NEW.id_transaccion;
	IF NEW.tipo_transaccion = false THEN
    INSERT INTO TransaccionFolioCliente (id_transaccion,estado) VALUES (NEW.id_transaccion, 0); 
    CALL folio(id); 
    CALL passw(id); 
	END IF;
    
 END$$

DELIMITER ;













TABLAS

Cliente (
	id INT PRIMARY KEY AUTO INCREMENT,
	nombre VARCHAR(50) NOT NULL,
	apellido_paterno VARCHAR(50) NOT NULL,
apellido_materno VARCHAR(50) NOT NULL,
calle VARCHAR(255) NOT NULL,
colonia VARCHAR,
codigo_postal VARCHAR(255) NOT NULL,
fecha_nacimiento DATE NOT NULL,
edad INT date() - fecha_nacimiento,
id_cuenta INT NOT NULL,

FOREIGN KEY (id_cuenta) REFERENCES Cuenta(id_cuenta)
);

Cuenta (
	id_cuenta INT PRIMARY KEY NOT NULL     //numero de cuenta
	fecha_apertura DATE NOT NULL
	saldo BIGINT	
);

Transacciones (
	id_transaccion INT PRIMARY KEY NOT NULL,
	fecha_transaccion DATE NOT NULL,
	hora_transaccion TIME NOT NULL, 
	cantidad INT NOT NULL
);



TransaccionNormalCliente (
id_transaccion INT,         // guardamos sin pk, solo referenciamos a la entidad padre
FOREIGN KEY  id_transaccion REFERENCES   Transaccion(id_transaccion )
);

TransaccionFolioCliente (
id_transaccion INT,
folio_transaccion VARCHAR(255),
password_transaccion VARCHAR(8),
FOREIGN KEY  id_transaccion REFERENCES   Transaccion(id_transaccion )
);




